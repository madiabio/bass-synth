#ifndef FUNCTION_GEN_H
#define FUNCTION_GEN_H

#include <stdint.h>

// Handles waveform mode
typedef enum {
    WAVE_SINE,
    WAVE_SAW,
    WAVE_TRI,
    WAVE_SQUARE
} waveform_t;

extern volatile waveform_t waveform_mode;
extern volatile uint32_t phase_acc;
extern volatile uint32_t phase_step;

// Convert 32-bit phase accumulator to a table index
// tbl_size must be a power of two (e.g. 256, 1024, 4096)
// EXAMPLE: 
// the sine table is 256 points ( see waveform.h )
// only need 256 = 2^8, therefore only need 8 bits of the phase accumulator to walk thru the table.
// phase_acci s a 32 bit int, therefore, extract the top 8 bits by shifting right. 32 - 8 = 24.
				
#define PHASE_TO_INDEX(acc, tbl_size) ((acc) >> (32 - __builtin_ctz(tbl_size)))


// This is the timer that will handle the function generator calculations
// The interrupt generated by this timer is essentially a metronome
void timer0a_init(void);
void init_PG1(void);
#endif